---
title: engine.ts
---

# `engine.ts`

This file contains the core "engine" that powers a single execution cycle of your Daydreams agent (what happens inside `agent.run`). Think of it as the conductor coordinating the agent's internal "perception -> reasoning -> action" loop. It manages the step-by-step process, keeps track of the current state, handles asynchronous tasks, and decides when the agent's current task is complete.

## How to Use

You generally **don't interact directly** with the `createEngine` function or the engine object it creates. The Daydreams framework uses this internally when you call `agent.run(...)` or `agent.send(...)`. It's responsible for:

- Loading the relevant context(s) and their memory.
- Figuring out which actions and outputs are available for the current step.
- Building the prompt for the AI model based on current state and new inputs.
- Receiving the AI model's response (including reasoning, action calls, outputs).
- Calling the appropriate handlers for actions and outputs.
- Managing the temporary "working memory" log for the current run.
- Repeating the process until the task is done or a limit is reached.

## Benefit

It encapsulates the complex logic of managing the agent's runtime execution flow. This ensures that inputs are processed, the AI model is consulted correctly, actions are executed, outputs are sent, and state is managed consistently throughout a multi-step task, without you needing to orchestrate these steps manually.

## Anticipated Questions

-   _"Do I ever need to call `createEngine` myself?"_
    No, this is handled internally by the framework when you use `agent.run()` or `agent.send()`.
-   _"What's the difference between this 'engine' and the `agent` object from `createDreams`?"_
    The `agent` object represents your overall configured agent. The `engine` is a temporary component created _by_ the agent for _each specific run_ (like handling one incoming message) to manage that run's lifecycle. 