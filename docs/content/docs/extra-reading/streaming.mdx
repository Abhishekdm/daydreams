---
title: streaming.ts
---

# `streaming.ts` (Internal Utility)

This internal file is responsible for processing the response from the AI language model (LLM) piece by piece, _as it streams in_, rather than waiting for the entire response. It uses the XML stream parser (`xml.ts`) to identify tags like `<reasoning>`, `<action_call>`, and `<output>` incrementally.

## How it Works Internally

When the LLM starts sending its response, the `handleStream` function reads the incoming text tokens. It feeds these tokens into the `xmlStreamParser`. As the parser identifies complete XML tags (like an `<action_call>` tag with its name and arguments), the `streamHandler` (created by `createContextStreamHandler`) converts this information into the appropriate internal log format (e.g., an `ActionCall` object). This log object is then immediately pushed into the agent's engine (`engine.ts`) for further processing (validation, handler execution). It also pushes partial updates (`LogChunk`) for real-time UI feedback.

## Benefit

Although internal, this streaming mechanism is crucial for making the Daydreams agent feel responsive. Because it processes the LLM's output incrementally, the agent can:

-   Start executing an `action` as soon as the `<action_call>` tag is fully received, even if the LLM is still generating the rest of its reasoning or other steps.
-   Start sending an `output` (like a chat message) quickly.
-   Provide real-time updates to user interfaces (showing thoughts or partial outputs as they arrive).

This avoids long pauses while waiting for the entire LLM response, leading to a much smoother user experience.

## Anticipated Questions

-   _"Do I need to configure streaming?"_
    No, streaming is enabled by default and handled internally by the framework.
-   _"How does this relate to the XML parser (`xml.ts`)?"_
    This file _uses_ the `xmlStreamParser` from `xml.ts` to do the actual work of reading the stream and identifying the XML tags and their content. `streaming.ts` orchestrates this process and translates the parser's output into the internal log objects the agent engine understands. 