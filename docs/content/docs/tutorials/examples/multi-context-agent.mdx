---
title: Multi-Context Agent
description:
  This guide will walk you through creating an AI agent that can respond to
  multiple contexts.
---

## Prerequisites

Before starting, make sure you have:

1. The following environment variables set up:
   - `OPENAI_API_KEY`: Your OpenAI API key

Create a file named `agent.ts`:

```typescript title="agent.ts"
import { createDreams, context, input, output } from "@daydreamsai/core";
import { cliExtension } from "@daydreamsai/cli";
import { openai } from "@ai-sdk/openai";
import { z } from "zod";

const fetchContext = context({
  type: "fetch",
  schema: z.object({}),
  instructions:
    "You are a helpful assistant that can fetch data from a test API. When asked, fetch and display data from the JSONPlaceholder API.",
  actions: {
    fetchPosts: {
      schema: z.object({
        limit: z.number().optional().default(5),
      }),
      description: "Fetch posts from the test API",
      handler: async ({ limit }) => {
        const response = await fetch(
          "https://jsonplaceholder.typicode.com/posts"
        );
        const posts = await response.json();
        return posts.slice(0, limit);
      },
    },
    fetchUser: {
      schema: z.object({
        userId: z.number(),
      }),
      description: "Fetch a specific user by ID",
      handler: async ({ userId }) => {
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/users/${userId}`
        );
        return response.json();
      },
    },
  },
});

// 1. Define the main context for our agent
const echoContext = context({
  type: "echo",
  // No specific arguments needed for this simple context
  schema: z.object({}),
  // Instructions that guide the LLM's behavior
  instructions:
    "You are a simple echo bot. Repeat the user's message back to them.",
});

// 2. Create the agent instance
const agent = createDreams({
  // Configure the LLM model to use
  model: openai("gpt-4o-mini"),
  // Include the CLI extension for input/output handling
  extensions: [cliExtension],
  // Register our custom context
  contexts: [echoContext, fetchContext],
});

// 3. Start the agent and run the context
async function main() {
  // Initialize the agent (sets up services like readline)
  await agent.start();

  console.log("Multi-context agent started. Type 'exit' to quit.");
  console.log("Available contexts:");
  console.log("1. Echo context - repeats your messages");
  console.log("2. Fetch context - fetches data from JSONPlaceholder test API");
  console.log("");

  // You can run different contexts based on user choice
  // For this example, we'll run the fetch context
  await agent.run({
    context: fetchContext,
    args: {}, // Empty object since our schema requires no arguments
  });

  // Agent stops when the input loop breaks (e.g., user types "exit")
  console.log("Agent stopped.");
}

// Start the application
main();
```

### Run your agent

Ensure your `OPENAI_API_KEY` environment variable is set, then run:

```bash title="run the agent"
node agent.ts
```

Your agent will start listening for input. You can interact with it in different
ways:

1. **Using the fetch context**: Ask it to fetch posts or user information from
   the JSONPlaceholder API (a free fake REST API for testing):

   - "Fetch me some posts"
   - "Get user with ID 1"
   - "Show me 3 posts from the API"

2. **Using the echo context**: Simply change the context in the `main()`
   function to `echoContext` to have it repeat your messages back.

The JSONPlaceholder API provides fake data for testing and prototyping,
including:

- `/posts` - 100 fake blog posts
- `/users` - 10 fake users with detailed information
- And more endpoints for comments, albums, photos, and todos

---
